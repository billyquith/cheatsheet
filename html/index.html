<html>
<head>
<title>Cheatsheet</title>
<script type="text/javascript" src="jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="jquery-sortable-lists.min.js"></script>
<!-- script type="text/javascript" src="js-yaml.min.js"></script -->
<script type="text/javascript" src="marked.min.js"></script>
<link rel="stylesheet" type="text/css" href="cheatsheet.css">
</head>

<body>

<script type="text/javascript">

function getURLParam(name) {
    var url = window.location.search.substring(1);
    var urlVars = url.split('&');
    for (var i=0; i < urlVars.length; i++) {
        var kv = urlVars[i].split('=');
        if (kv[0] == name) {
            return kv[1];
        }
    }
    return null;
}

function transformDoc() {
    // turn each sub-section (h2) into a list item
	$('#placeholder h2').each(function (i) {
		$(this).replaceWith(
			$('<li/>')
				.append($('<div/>').append($(this).text()))
				.append($(this).next()));
	});
    // wrap the list items in a list
	$('#placeholder > li').wrapAll('<ul class="cheatsheet listsClass"></ul>');
}

$(document).ready(function()
{
    var options = {
        opener: {
			 active: true,
			 close: './imgs/Remove2.png',
			 open: './imgs/Add2.png',
			 openerCss: {
				 'display': 'inline-block',
				 'width': '18px',
				 'height': '18px',
				 'float': 'left',
				 'margin-left': '-35px',
				 'margin-right': '5px',
				 'background-position': 'center center',
				 'background-repeat': 'no-repeat'
			 },
			 openerClass: ''
		}
    };
	
    var cheatFileUrl = getURLParam('sheet') || 'test';
	//var cheatFileUrl = '../sheets/test.md';
    cheatFileUrl = '../sheets/' + cheatFileUrl + '.md';
    try {
        console.log('requesting: ' + cheatFileUrl);
        $.get(cheatFileUrl, function(data) {
            var doc = marked(data);
			$('#placeholder').append(doc);
			transformDoc();
            $(".cheatsheet").sortableLists(options);
        });    
    } catch (e) {
        console.log(e);
    }
});

</script>

<div id="placeholder"></div>

</body>
</html>